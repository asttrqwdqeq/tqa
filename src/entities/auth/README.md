# Auth System

–ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º TanStack Query –∏ Axios.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
entities/auth/
‚îú‚îÄ‚îÄ provider/
‚îÇ   ‚îî‚îÄ‚îÄ auth-provider.tsx    # React Context + TanStack Query
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îî‚îÄ‚îÄ use-auth-queries.ts  # –•—É–∫–∏ –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
‚îú‚îÄ‚îÄ index.ts                 # –≠–∫—Å–ø–æ—Ä—Ç—ã –º–æ–¥—É–ª—è
‚îî‚îÄ‚îÄ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

shared/api/
‚îî‚îÄ‚îÄ auth.ts                 # API –º–µ—Ç–æ–¥—ã –∏ —Ç–∏–ø—ã
```

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### ‚úÖ –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –±—ç–∫–µ–Ω–¥–∞
- `POST /auth/admin/login` - –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
- `POST /auth/admin/logout` - –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã  
- `GET /auth/admin/me` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /auth/admin/refresh` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- `GET /auth/admin/verify` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞

### ‚úÖ Cookie-based –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- **HttpOnly cookies** - —Ç–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞** - cookies –≤–∫–ª—é—á–∞—é—Ç—Å—è –≤–æ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã (`withCredentials: true`)  
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- **–£–º–Ω—ã–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã** - `/login` ‚Üî `/(private)` –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è** —Å TanStack Query
- **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π logout** - cookies –æ—á–∏—â–∞—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏—è
- `isAuthenticated` - —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `isLoading` - –∑–∞–≥—Ä—É–∑–∫–∞
- `isInitialized` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- `user` - –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°–æ—Å—Ç–æ—è–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π (login, logout)

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### AuthProvider
–û–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

```tsx
import { AuthProvider } from "@/entities/auth";

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <AuthProvider>
        {children}
      </AuthProvider>
    </QueryClientProvider>
  );
}
```

### useAuth Hook
–û—Å–Ω–æ–≤–Ω–æ–π —Ö—É–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π:

```tsx
import { useAuth } from "@/entities/auth";

function Component() {
  const { 
    user,           // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    isAuthenticated, // –°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    isLoading,      // –ó–∞–≥—Ä—É–∑–∫–∞
    login,          // –ú–µ—Ç–æ–¥ –≤—Ö–æ–¥–∞
    logout,         // –ú–µ—Ç–æ–¥ –≤—ã—Ö–æ–¥–∞
    refreshAuth     // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
  } = useAuth();

  return (
    <div>
      {isAuthenticated ? (
        <p>–ü—Ä–∏–≤–µ—Ç, {user.username}!</p>
      ) : (
        <p>–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</p>
      )}
    </div>
  );
}
```

### –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ö—É–∫–∏
–î–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```tsx
import { 
  useCurrentUser,
  useLogin, 
  useLogout,
  useCheckAuth 
} from "@/entities/auth";

function CustomComponent() {
  const userQuery = useCurrentUser();
  const loginMutation = useLogin();
  const logoutMutation = useLogout();
  const { checkAuth } = useCheckAuth();
  
  // –í–∞—à–∞ –ª–æ–≥–∏–∫–∞
}
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:
- ‚úÖ 401 –æ—à–∏–±–∫–∏ (–Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)
- ‚úÖ –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏
- ‚úÖ –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- ‚úÖ –¢–∞–π–º–∞—É—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤

## –ü—É–±–ª–∏—á–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã

–ú–∞—Ä—à—Ä—É—Ç—ã –Ω–µ —Ç—Ä–µ–±—É—é—â–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
- `/` - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- `/login` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞

–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã —Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

API URL –∑–∞–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```env
NEXT_PUBLIC_API_URL=http://localhost:3001/api
```

## Cookie-based –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### üç™ –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã
1. **–õ–æ–≥–∏–Ω** ‚Üí —Å–µ—Ä–≤–µ—Ä —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç httpOnly cookie —Å —Ç–æ–∫–µ–Ω–æ–º
2. **–ó–∞–ø—Ä–æ—Å—ã** ‚Üí –±—Ä–∞—É–∑–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç cookie —Å –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º  
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞** ‚Üí —Å–µ—Ä–≤–µ—Ä –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ cookie
4. **Logout** ‚Üí —Å–µ—Ä–≤–µ—Ä —É–¥–∞–ª—è–µ—Ç/–∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç cookie

### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±—ç–∫–µ–Ω–¥–∞
–°–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω:
```javascript
// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ cookie –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ
res.cookie('access_token', token, {
  httpOnly: true,    // –ó–∞—â–∏—Ç–∞ –æ—Ç XSS
  secure: true,      // –¢–æ–ª—å–∫–æ HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
  sameSite: 'strict', // –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF
  maxAge: 15 * 60 * 1000 // 15 –º–∏–Ω—É—Ç
});

// CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
app.use(cors({
  origin: 'http://localhost:3000', // –î–æ–º–µ–Ω —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
  credentials: true // –†–∞–∑—Ä–µ—à–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É cookies
}));
```

### üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
```typescript
// –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞—é—Ç cookies
const api = axios.create({
  withCredentials: true // ‚Üê –ö–ª—é—á–µ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
});
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ **HttpOnly cookies** - –∑–∞—â–∏—Ç–∞ –æ—Ç XSS –∞—Ç–∞–∫
- ‚úÖ **SameSite=Strict** - –∑–∞—â–∏—Ç–∞ –æ—Ç CSRF –∞—Ç–∞–∫  
- ‚úÖ **Secure –≤ HTTPS** - –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π logout** - —É–¥–∞–ª–µ–Ω–∏–µ cookies –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ**